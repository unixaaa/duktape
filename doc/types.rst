==============
Duktape typing
==============

Internal and external type summary
==================================

The table below summarizes various types and how they appear in the external
API and internals.  What's missing from the table:

* ``duk_hobject`` has a flags field which allows some logical types to be
  distinguished from one another.  For example, bound functions have a
  specific internal flag.  Other structs also have flags that may be relevant
  to typing but are not presented in the table.

+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| Ecmascript code            | API type            | API type check(s)      | Internal duk_tval tag | Internal struct(s)      |                                     | Ecmascript typeof | Ecmascript Object .toString() | Notes                             |
+============================+=====================+========================+=======================+=========================+=====================================+===================+===============================+===================================+
| n/a                        | DUK_TYPE_NONE       | duk_is_valid_index()   | DUK_TAG_UNUSED        | n/a                     |                                     | n/a               | n/a                           | Marker for "no value" when doing  |
|                            |                     |                        |                       |                         |                                     |                   |                               | a valus stack type lookup.        |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| void 0                     | DUK_TYPE_UNDEFINED  | duk_is_undefined()     | DUK_TAG_UNDEFINED     | n/a                     |                                     | undefined         | [object Undefined]            |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| null                       | DUK_TYPE_NULL       | duk_is_null()          | DUK_TAG_NULL          | n/a                     |                                     | object (!)        | [object Null]                 |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| true                       | DUK_TYPE_BOOLEAN    | duk_is_boolean()       | DUK_TAG_BOOLEAN       | n/a                     |                                     | boolean           | [object Boolean]              |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| 123                        | DUK_TYPE_NUMBER     | duk_is_number()        | DUK_TAG_FASTINT       | n/a                     |                                     | number            | [object Number]               | If 48-bit signed int, and fastint |
|                            |                     |                        |                       |                         |                                     |                   |                               | support enabled.                  |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| 123.1                      | DUK_TYPE_NUMBER     | duk_is_number()        | DUK_TAG_NUMBER (*)    | n/a                     |                                     | number            | [object Number]               | With packed duk_tval, no explicit |
|                            |                     |                        |                       |                         |                                     |                   |                               | internal tag.                     |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| "foo"                      | DUK_TYPE_STRING     | duk_is_string()        | DUK_TAG_STRING        | duk_hstring             |                                     | string            | [object String]               |                                   |
|                            |                     |                        |                       | duk_hstring_external    |                                     |                   |                               |                                   | 
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| Symbol('foo')              | DUK_TYPE_STRING     | duk_is_string()        | DUK_TAG_STRING        | duk_hstring             |                                     | symbol            | [object Symbol]               | Symbols                           |
|                            |                     |                        |                       | duk_hstring_external    |                                     |                   |                               | (NOT FINALIZED)                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| n/a                        | DUK_TYPE_LIGHTFUNC  | duk_is_lightfunc()     | DUK_TAG_LIGHTFUNC     | n/a                     |                                     | function          | [object Function]             |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| ArrayBuffer.allocPlain(1)  | DUK_TYPE_BUFFER     | duk_is_buffer()        | DUK_TAG_BUFFER        | duk_hbuffer_fixed       |                                     | object            | [object ArrayBuffer]          |                                   |
|                            |                     |                        |                       | duk_hbuffer_dynamic     |                                     |                   |                               |                                   |
|                            |                     |                        |                       | duk_hbuffer_external    |                                     |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| Duktape.Pointer('dummy')   | DUK_TYPE_POINTER    | duk_is_pointer()       | DUK_TAG_POINTER       | n/a                     | n/a                                 | pointer           | [object Pointer]              |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| n/a                        | n/a                 | duk_is_valid_index()   | n/a                   | n/a                     | DUK_HOBJECT_CLASS_NONE              | n/a               | n/a                           | Marker for "no value" when doing  |
|                            |                     |                        |                       |                         |                                     |                   |                               | a class number lookup.            |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| { foo: 123 }               | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_OBJECT            | object            | [object Object]               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| [ 1, 2, 3 ]                | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_harray              | DUK_HOBJECT_CLASS_ARRAY             | object            | [object Array]                | duk_harray extends duk_hobject.   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| arguments                  | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_ARGUMENTS         | object            | [object Arguments]            | Not an array; array-like.         |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_BOOLEAN           |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_DATE              |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_ERROR             |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| Math.cos                   | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hnatfunc            | DUK_HOBJECT_CLASS_FUNCTION          |                   |                               | duk_hnatfunc extends duk_hobject. |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| function foo() {}          | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hcompfunc           | DUK_HOBJECT_CLASS_FUNCTION          |                   |                               | duk_hcompfunc extends duk_hobject.|
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| func.bind(null, 123)       | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_FUNCTION          |                   |                               | duk_hobject flag                  |
|                            |                     |                        |                       |                         |                                     |                   |                               | DUK_HOBJECT_FLAG_BOUNDFUNC is set.|
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| JSON                       | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_JSON              |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| Math                       | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_MATH              |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| new Number(123)            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_NUMBER            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| /foo/                      | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_REGEXP            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| new String('foo')          | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_STRING            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| Object(Symbol('foo'))      | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_SYMBOL            |                   |                               | (NOT FINALIZED)                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_GLOBAL            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| n/a                        | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_OBJENV            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| n/a                        | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_DECENV            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hobject             | DUK_HOBJECT_CLASS_POINTER           |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hthread             | DUK_HOBJECT_CLASS_THREAD            |                   |                               |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| new ArrayBuffer(8)         | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_ARRAYBUFFER       |                   | [object ArrayBuffer]          | duk_hbufobj extends duk_hobject.  |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| new DataView(arrBuf)       | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_DATAVIEW          |                   | [object DataView]             |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_INT8ARRAY         |                   | [object Int8Array]            |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_UINT8ARRAY        |                   | [object Uint8Array]           |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
| new Uint8ClampedArray(1)   | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_UINT8CLAMPEDARRAY | object            | [object Uint8ClampedArray]    |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_INT16ARRAY        |                   | [object Int16Array]           |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_UINT16ARRAY       |                   | [object Uint16Array]          |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_INT32ARRAY        |                   | [object Int32Array]           |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_UINT32ARRAY       |                   | [object Uint32Array]          |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_FLOAT32ARRAY      |                   | [object Float32Array]         |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
|                            | DUK_TYPE_OBJECT     | duk_is_object()        | DUK_TAG_OBJECT        | duk_hbufobj             | DUK_HOBJECT_CLASS_FLOAT64ARRAY      |                   | [object Float64Array]         |                                   |
+----------------------------+---------------------+------------------------+-----------------------+-------------------------+-------------------------------------+-------------------+-------------------------------+-----------------------------------+
